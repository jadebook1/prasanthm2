CREATE VIEW IssueView AS
SELECT 
    ISSUE.CREATOR,
    ISSUE.CRRNTDDT,
    ISSUE.ISSDESCR,
    LISTAGG(ENUMVALS.NAME, ', ') WITHIN GROUP (ORDER BY ENUMVALS.NAME) AS ISSUE_STATUS_NAME,
    ISSUE.TTL,
    ISSUE.MS_ISSUE_ID AS ISSUE_RESOURCE_ID,
    ACTIONPLAN.NAMEO0 AS ACTION_PLAN_NAME,
    ACTIONPLAN.MS_ACTIONPLAN_ID AS ACTION_PLAN_RESOURCE_ID,
    LISTAGG(ENTITY.BE_GEOLOCID, ', ') WITHIN GROUP (ORDER BY ENTITY.BE_GEOLOCID) AS GEOLOCIDS,
    LISTAGG(ENTITY.BE_LEGLCODE, ', ') WITHIN GROUP (ORDER BY ENTITY.BE_LEGLCODE) AS LEGCODES,
    LISTAGG(ENTITY.ENTITY_ID, ', ') WITHIN GROUP (ORDER BY ENTITY.ENTITY_ID) AS ENTITY_RESOURCE_IDS,
    LISTAGG(ASSOC_TYPE.NAME00, ', ') WITHIN GROUP (ORDER BY ASSOC_TYPE.NAME00) AS ASSOC_TYPE_NAMES
FROM DCRGTIOP.RT_MS_ISSUE ISSUE
LEFT JOIN DCRGTIOP.ENUMVALS ENUMVALS ON ISSUE.STTS = ENUMVALS.ENUMVALID
LEFT JOIN DCRGTIOP.RT_MS_ISSUE_MS_ACTIONPLAN ISSUE_ACTIONPLAN ON ISSUE.MS_ISSUE_ID = ISSUE_ACTIONPLAN.MS_ISSUE_ID
LEFT JOIN DCRGTIOP.RT_MS_ACTIONPLAN ACTIONPLAN ON ISSUE_ACTIONPLAN.MS_ACTIONPLAN_ID = ACTIONPLAN.MS_ACTIONPLAN_ID
LEFT JOIN DCRGTIOP.RT_MS_ISSUE_MS_ASSOCTYPE ISSUE_ASSOCTYPE ON ISSUE.MS_ISSUE_ID = ISSUE_ASSOCTYPE.MS_ISSUE_ID
LEFT JOIN DCRGTIOP.RT_MS_ASSOCTYPE ASSOC_TYPE ON ISSUE_ASSOCTYPE.MS_ASSOCTYPE_ID = ASSOC_TYPE.MS_ASSOCTYPE_ID
LEFT JOIN DCRGTIOP.RT_ENTITY_MS_ASSOCTYPE ENTITY_ASSOCTYPE ON ENTITY_ASSOCTYPE.MS_ASSOCTYPE_ID = ASSOC_TYPE.MS_ASSOCTYPE_ID
LEFT JOIN DCRGTIOP.RT_ENTITY ENTITY ON ENTITY_ASSOCTYPE.ENTITY_ID = ENTITY.ENTITY_ID
GROUP BY ISSUE.CREATOR, ISSUE.CRRNTDDT, ISSUE.ISSDESCR, ISSUE.TTL, ISSUE.MS_ISSUE_ID, ACTIONPLAN.NAMEO0, ACTIONPLAN.MS_ACTIONPLAN_ID;
